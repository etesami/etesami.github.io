<!DOCTYPE html>
<html lang="en">

<head>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-148462557-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-148462557-1');
  </script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Ehsan Etesami | Migrate a Single WordPress site to Multisite WordPress System Using WP CLI</title>

  <!-- Bootstrap core CSS -->
  <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <!-- Custom styles for this template -->
  <link rel="stylesheet" href="/assets/css/styles.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.ico?">

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Migrate a Single WordPress site to Multisite WordPress System Using WP CLI | Ehsan Etesami</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Migrate a Single WordPress site to Multisite WordPress System Using WP CLI" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Transferring a single WordPress site to a multisite WordPress system can become complicated, especially if you have a large website with many contents and plugins. Here we will see how we can manually transfer a single site using the WP command-line interface. In this document, we assume you have access to the servers hosting your websites and have created a multisite WordPress network, and you are ready to transfer your site." />
<meta property="og:description" content="Transferring a single WordPress site to a multisite WordPress system can become complicated, especially if you have a large website with many contents and plugins. Here we will see how we can manually transfer a single site using the WP command-line interface. In this document, we assume you have access to the servers hosting your websites and have created a multisite WordPress network, and you are ready to transfer your site." />
<link rel="canonical" href="https://etesami.github.io/2020/02/18/migrate-single-to-multisite-wordpress-site.html" />
<meta property="og:url" content="https://etesami.github.io/2020/02/18/migrate-single-to-multisite-wordpress-site.html" />
<meta property="og:site_name" content="Ehsan Etesami" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-02-18T00:00:00-05:00" />
<script type="application/ld+json">
{"headline":"Migrate a Single WordPress site to Multisite WordPress System Using WP CLI","dateModified":"2020-02-18T00:00:00-05:00","datePublished":"2020-02-18T00:00:00-05:00","url":"https://etesami.github.io/2020/02/18/migrate-single-to-multisite-wordpress-site.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://etesami.github.io/2020/02/18/migrate-single-to-multisite-wordpress-site.html"},"description":"Transferring a single WordPress site to a multisite WordPress system can become complicated, especially if you have a large website with many contents and plugins. Here we will see how we can manually transfer a single site using the WP command-line interface. In this document, we assume you have access to the servers hosting your websites and have created a multisite WordPress network, and you are ready to transfer your site.","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


</head>

<body>

  <!-- Navigation -->
<nav class="navbar fixed-top navbar-expand-lg navbar-light fixed-top bg-bluelight">
  <div class="container">
    <a class="navbar-brand" href="/index.html">
       Ehsan Etesami
      
    </a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
          <li class="nav-item">
            <a class="nav-link  " href="/"> Home</a>
          </li>
        
          <li class="nav-item">
            <a class="nav-link  " href="/education.html"> Education</a>
          </li>
        
          <li class="nav-item">
            <a class="nav-link  " href="/publication.html"> Publication</a>
          </li>
        
          <li class="nav-item">
            <a class="nav-link  " href="/teaching.html"> Teaching</a>
          </li>
        
          <li class="nav-item">
            <a class="nav-link  " href="/blog.html"> Blog</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  <!-- Header Slide -->

  <!-- Page Content -->
  <div class="container">

    <h1 class="my-4">
      
      Migrate a Single WordPress site to Multisite WordPress System Using WP CLI
    </h1>

    
      <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="/index.html">Home</a>
  </li>
  
    <li class="breadcrumb-item active"><a href="/blog.html">Blog</a></li>
  
  <li class="breadcrumb-item active">Migrate a Single WordPress site to Multisite WordPress System Using WP CLI</li>
</ol>

    
    
    <hr>

    <div class="row justify-content-lg-center">

  <!-- Blog Entries Column -->
  <div class="col-lg-10 col-12">
    <!-- Blog Post -->
    <div class="my-3 text-muted">
      February 18, 2020
    </div>    
    <div class="card-text"><p>Transferring a single WordPress site to a multisite WordPress system can become complicated, especially if you have a large website with many contents and plugins. Here we will see how we can manually transfer a single site using the <a href="https://wp-cli.org">WP command-line interface</a>. In this document, we assume you have access to the servers hosting your websites and have created a <a href="https://wordpress.org/support/article/create-a-network/">multisite WordPress network</a>, and you are ready to transfer your site.</p>

<h2>Getting Started</h2>
<h4>Backup Eveything</h4>
<p>Backup your files and your database:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">ubuntu@VM1:~<span class="nv">$ </span>wp db <span class="nt">--dbuser</span><span class="o">=</span>&lt;db_username&gt; <span class="nb">export </span>db.sql
ubuntu@VM1:~<span class="nv">$ </span><span class="nb">tar</span> <span class="nt">-C</span> /var/www <span class="nt">-zcvf</span> files.tar.gz wordpress </code></pre></figure>

<h4>Copy Files to New Multisite Folder</h4>
<p>When you create a new site in multisite WordPress, a corresponding folder for that is created. Assume the WordPress picks up the id <strong>8</strong> for this site; thus its contents are stored in:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/path/to/multisite-root/wp-content/uploads/sites/8
</code></pre></div></div>
<p>Copy all uploaded contents to the new location:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">ubuntu@VM1:~<span class="nv">$ </span><span class="nb">cp</span> <span class="nt">-rp</span> /path/to/singlesite-root/wp-content/uploads/<span class="k">*</span> <span class="se">\</span>
                     /path/to/multisite-root/wp-content/uploads/sites/8/</code></pre></figure>

<h4>Find and Install Plugins</h4>
<p>Before you proceed, you have to install and activate all used plugins and themes in the multisite WordPress. To get the list of installed plugins in the single-site WordPress:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">ubuntu@VM1:~<span class="nv">$ </span>wp plugin list
ubuntu@VM1:~<span class="nv">$ </span>wp theme list
<span class="c"># On the mutisite WordPress:</span>
ubuntu@VM1:~<span class="nv">$ </span>wp plugin <span class="nb">install</span> &lt;name-of-plugin&gt; <span class="nt">--activate-network</span></code></pre></figure>

<h4>Export wp-options Table and Contents</h4>
<p>Plugins settings and configuration you have made are all stored in the <strong>wp-options</strong> table. In a multisite environment, each site has its own set of tables. They are distinguished by getting a unique prefix. For instance, <em>wp-options</em> for our target site is became <strong>wp-8-options</strong>. We first export this table from single-site WordPress:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># To export wp-options table from database</span>
ubuntu@VM1:~<span class="nv">$ </span>wp db <span class="nt">--dbuser</span><span class="o">=</span>root <span class="nb">export</span> <span class="nt">--tables</span><span class="o">=</span>wp_options ~/wordpress_options.sql 
<span class="c"># To export all posts, pages, menus and etc. into a XML file:</span>
ubuntu@VM1:~<span class="nv">$ </span>wp <span class="nb">export</span></code></pre></figure>

<h4>Perform Modifications</h4>
<p>Now we have two files which we have to perform some filtering on them. In particular, we need to change the <strong>path to the contents</strong> and the <strong>site URL</strong> and <strong>home URL</strong>.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">ubuntu@VM1:~<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/wp_/wp_8_/g'</span> ~/wordpress_options.sql </code></pre></figure>

<p>Open the <code class="highlighter-rouge">~/wordpress_options.sql</code> and change the <strong>site URL</strong> and <strong>home URL</strong> to multisite URL in the first line of <strong>INSERT TO</strong> statement.</p>

<p>Once you finish that, it is time to change some paths on the XML file which contains the contents of your site:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">ubuntu@VM1:~<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/&lt;old-url&gt;/&lt;new-url&gt;/g'</span> &lt;xml-file&gt;
ubuntu@VM1:~<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/http:\/wp-content/http:\/\/&lt;new-url&gt;\/wp-content/g'</span> &lt;xml-file&gt;
ubuntu@VM1:~<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/wp-content\/uploads/wp-content\/uploads\/sites\/8/g'</span> &lt;xml-file&gt;</code></pre></figure>

<p>By now, we are almost done. We need to import the <code class="highlighter-rouge">~/wordpress_options.sql</code> and <code class="highlighter-rouge">&lt;xml-file&gt;</code> into the database.</p>

<h4>Import into Database</h4>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">ubuntu@VM1:~<span class="nv">$ </span>wp db <span class="nt">--dbuser</span><span class="o">=</span>root import ~/wordpress_options.sql 
<span class="c"># On the multisite WordPress perform:</span>
ubuntu@VM1:~<span class="nv">$ </span>wp import <span class="nt">--authors</span><span class="o">=</span>usermaps.csv <span class="nt">--url</span><span class="o">=</span>&lt;site-url&gt; &lt;xml-file&gt;</code></pre></figure>

<p>Check the output of the above commands for any failure during the import procedure. If you get some error, look for the corresponding attachments in the <code class="highlighter-rouge">&lt;xml-file&gt;</code>. You probably need to correct the paths of a few items. The file <code class="highlighter-rouge">usermaps.csv</code> provides a mapping from contents’ authors and the current existing users in the multisite WordPress. It looks like:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">ubuntu@VM1:~<span class="nv">$ </span><span class="nb">cat </span>usermaps.csv
old_user_login,new_user_login
old-username1,new-username1
old-username2,new-username2</code></pre></figure>

<h4>Final Step: Search and Replace</h4>
<p>Often times, you will see some images or links which still are using the <code class="highlighter-rouge">&lt;old-url&gt;‍‍‍‍‍‍‍</code>. To check the whole database for any occurances:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">ubuntu@VM1:~<span class="nv">$ </span>wp search-replace <span class="s1">'&lt;old-url&gt;'</span> <span class="s1">'&lt;new-url&gt;'</span> <span class="nt">--url</span><span class="o">=</span>&lt;new-url&gt; <span class="nt">--precise</span></code></pre></figure>

<p>Although this is a useful tool, however, you can also dump the whole database and replace whatever is needed as well.</p>
</div> 
    <hr>
    <div class="categories">
    	
			  <span class="badge badge-info">WordPress</span>
			
		</div>
		<div class="more-links mt-3">
		
			
			  
		  

		  
		  	
		  
		  	
		  
		  	
		  
		  	
		  
		  	
		  
		  	
		  
		  	
		  
		  

    </div> 
  </div>

</div>
<!-- /.row -->


  </div>
  <!-- /.container -->

  
  <!-- Footer -->
<footer class="py-3 bg-bluelight">
  <div class="container">
    <p class="m-0 text-center text-black txt-small">Copyright &copy; 2021, Ehsan Etesami</p>
  </div>
  <!-- /.container -->
</footer>


  <!-- Bootstrap core JavaScript -->
  <script src="/vendor/jquery/jquery.min.js"></script>
  <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

</body>

</html>
